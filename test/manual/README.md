# Manual Test for RAINS Toolset

A user can try out different RAINS components, including RAINS server, publisher, keymanager, and rdig, by manually running them (as command-line tools). This hands-on exercise is good for getting familiar with RAINS and allows tests over arbitrary data.

## Setup

Folder structure

- conf/ 

  Configuration files for RAINS servers (authoritative name servers and resolvers) and publishers. Options in a configuration file will be overriden by those specified in the command line.

  The currently provided configurations are intended for tests on a single local machine. For tests over a networked setting, please modify the files accordingly.

- keys/

  Delegation keys of zones to sign assertions.
  
  A key pair (`_pub.pem`, `_sec.pem`) can be generated by `keyManager gen`. Please see the man page for usage.
  
  The self-signed delegation assertion (mainly for the `root` zone, i.e., `selfSignedRootDelegationAssertion.gob`), can be generated by `keyManager selfsign`. Please see the man page for usage.

- zonefiles/

  The provided zone files contain example assertions for the `root`, the `.ch` TLD, and the `ethz.ch` SLD. The syntax of zone files can be found [here](../../docs/zonefile-format.md).
  
- tls_cert/

  TLS certificates used by RAINS servers to etablish TLS connections.

- scripts/

  Simple scripts to facilitate manual tests.

## Run Test

At this moment, RAINS supports two types of transport: TCP and SCION UDP Sockets. They differ only slightly in configuration. The following procedures use TCP, and the case for SCION connection is similar.

> There are currently some issue with the case for SCION connection, see [Issue #20](https://github.com/netsys-lab/scion-rains/issues/20).

1. Launch authoritative name servers:

   `./scripts/tcp_ns_root.sh`
   
   `./scripts/tcp_ns_ch.sh` (another terminal)
   
   `./scripts/tcp_ns_ethz.sh` (another terminal)
   
2. Launch publishers:

   `./scripts/tcp_publishers.sh`
   
> Currently, the publishers will report an error message but this does not prevent successful zone publication. See [Issue #19](https://github.com/netsys-lab/scion-rains/issues/19).
   
3. Launch a recursive resolver:

   `./scripts/tcp_resolver.sh`
   
4. Use `rdig` to send queries:

   `[path_to_rdig] -p 5025 @127.0.0.1 www.ethz.ch. ip4`
   
   `[path_to_rdig] -p 5025 @127.0.0.1 www.ethz.ch. cert`
   
   `[path_to_rdig] -p 5025 @127.0.0.1 ethz.ch. redir`
   
   Other queries can be formulated in a similar way. Please refer to the man page of `rdig` for all options.
   
